# Single-Component Deployment Environment Variables for Choreo

# ==============================================
# SINGLE COMPONENT DEPLOYMENT CONFIGURATION
# ==============================================
# This configuration deploys API + Blazor in a single container
# with nginx as reverse proxy routing traffic to both services

# ==============================================
# APPLICATION URLs
# ==============================================
# Replace with your actual Choreo component URL
# Both API and Blazor will be served from the same URL
APP_URL=https://your-bookstore-component.choreoapis.dev

# ==============================================
# API CONFIGURATION
# ==============================================
# API will be accessible at: https://your-component.choreoapis.dev/api/*
# Swagger UI at: https://your-component.choreoapis.dev/swagger
# Auth endpoints at: https://your-component.choreoapis.dev/connect/*

App__SelfUrl=${APP_URL}
App__CorsOrigins=${APP_URL}
App__RedirectAllowedUrls=${APP_URL}

# ==============================================
# BLAZOR CONFIGURATION
# ==============================================
# Blazor will be accessible at: https://your-component.choreoapis.dev/
# Uses the same URL as API (nginx routes based on path)

# ==============================================
# AUTHENTICATION CONFIGURATION
# ==============================================
# Both API and Blazor use the same base URL for auth
AuthServer__Authority=${APP_URL}
AuthServer__RequireHttpsMetadata=true
AuthServer__SwaggerClientId=BookStore_Swagger

# ==============================================
# DATABASE CONNECTIONS
# ==============================================
# PostgreSQL Connection String
ConnectionStrings__Default=Host=your-postgres-host;Port=5432;Database=BookStore;User ID=your-db-user;Password=your-secure-password;

# MongoDB Connection String
ConnectionStrings__MongoDB=mongodb://your-mongo-user:your-secure-password@your-mongo-host:27017/BookStore?authSource=admin

# ==============================================
# SECURITY SETTINGS
# ==============================================
# Generate strong random values for production:
# openssl rand -base64 32

# Certificate password (used for HTTPS certificate)
AuthServer__CertificatePassPhrase=your-secure-cert-password

# String encryption passphrase (used for encrypting sensitive data)
StringEncryption__DefaultPassPhrase=your-secure-encryption-passphrase

# ==============================================
# INTERNAL CONFIGURATION (DO NOT MODIFY)
# ==============================================
# These are internal settings used by nginx and supervisor
# API runs on internal port 5000
# Blazor runs on internal port 5001
# Nginx exposes everything on port 8080

ASPNETCORE_ENVIRONMENT=Production

# ==============================================
# DEPLOYMENT NOTES
# ==============================================
# 
# 1. Architecture:
#    - Nginx (port 8080) → API (port 5000) for /api/*, /connect/*, /Account/*, /swagger, /health-status
#    - Nginx (port 8080) → Blazor (port 5001) for all other paths (/, /books, /authors, etc.)
#
# 2. Before deploying:
#    - Create PostgreSQL database (Choreo managed or external)
#    - Create MongoDB database (Choreo managed or external)
#    - Run database migrator to create schema and seed data
#
# 3. Database Migrator Configuration:
#    You still need to run the migrator separately (as a Manual Task) with:
#    - ConnectionStrings__Default=<same as above>
#    - ConnectionStrings__MongoDB=<same as above>
#    - OpenIddict__Applications__BookStore_Blazor__RootUrl=${APP_URL}
#
# 4. Choreo Component Settings:
#    - Component Type: Service or Web Application
#    - Build Type: Dockerfile
#    - Dockerfile Path: Dockerfile.single
#    - Docker Context: . (root)
#    - Port: 8080
#    - Health Check Path: /health-status
#    - Network Visibility: Public
#
# 5. Advantages of Single Component:
#    ✅ Simpler deployment (one component instead of three)
#    ✅ Single URL for everything
#    ✅ No CORS configuration needed
#    ✅ Easier for small-scale deployments
#
# 6. Disadvantages of Single Component:
#    ❌ Can't scale API and Blazor independently
#    ❌ Higher resource usage (both services always running)
#    ❌ More complex Dockerfile and configuration
#    ❌ Harder to debug and monitor separately
#
# 7. When to use Single Component:
#    - Development/testing environments
#    - Small-scale deployments
#    - When simplicity is more important than scalability
#    - When you have limited component quotas
#
# 8. When to use Multi-Component:
#    - Production environments
#    - Need to scale API and Blazor independently
#    - Better resource utilization
#    - Better monitoring and debugging
#
# ==============================================
# TESTING LOCALLY
# ==============================================
# 
# Build the single container:
# docker build -f Dockerfile.single -t bookstore-single .
#
# Run with environment variables:
# docker run -p 8080:8080 \
#   -e ConnectionStrings__Default="Host=postgres;..." \
#   -e ConnectionStrings__MongoDB="mongodb://..." \
#   -e App__SelfUrl="http://localhost:8080" \
#   bookstore-single
#
# Access application:
# - Blazor UI: http://localhost:8080
# - API Swagger: http://localhost:8080/swagger
# - Health Check: http://localhost:8080/health-status
#
# ==============================================
